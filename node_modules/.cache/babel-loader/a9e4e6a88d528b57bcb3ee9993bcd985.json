{"ast":null,"code":"import { isNullOrUndefined, addClass, createElement, append, EventHandler, extend, remove } from '@syncfusion/ej2-base';\nimport { ListBase } from '@syncfusion/ej2-lists';\nimport { DataManager, Query } from '@syncfusion/ej2-data';\nimport { ViewBase } from '../renderer/view-base';\nimport * as util from '../base/util';\nimport * as cls from '../base/css-constant';\nimport * as event from '../base/constant';\n\nvar AgendaBase =\n/** @class */\nfunction () {\n  /**\n   * Constructor for AgendaBase\n   */\n  function AgendaBase(parent) {\n    this.parent = parent;\n    this.viewBase = new ViewBase(parent);\n  }\n\n  AgendaBase.prototype.createAgendaContentElement = function (type, listData, aTd, groupOrder, groupIndex) {\n    var listElement;\n\n    if (type === 'noEvents') {\n      var noEvents = [{\n        'subject': this.parent.localeObj.getConstant('noEvents')\n      }];\n      listElement = ListBase.createList(this.parent.createElement, noEvents, {\n        moduleName: 'agenda',\n        listClass: this.parent.activeView.viewClass,\n        itemClass: this.parent.activeView.viewClass,\n        template: '<div class=' + cls.AGENDA_NO_EVENT_CLASS + '>${subject}</div>'\n      });\n    } else {\n      listElement = ListBase.createList(this.parent.createElement, listData, {\n        moduleName: 'agenda',\n        listClass: this.parent.activeView.viewClass,\n        itemClass: this.parent.activeView.viewClass\n      });\n\n      for (var li = 0, length_1 = listData.length; li < length_1; li++) {\n        var appWrapper = createElement('div', {\n          className: cls.APPOINTMENT_CLASS,\n          attrs: {\n            'data-id': 'Appointment_' + listData[li][this.parent.eventFields.id],\n            'data-guid': listData[li].Guid,\n            'role': 'button',\n            'tabindex': '0',\n            'aria-readonly': 'false',\n            'aria-selected': 'false',\n            'aria-grabbed': 'true',\n            'aria-label': listData[li][this.parent.eventFields.subject] || this.parent.eventSettings.fields.subject.default\n          }\n        });\n\n        if (!isNullOrUndefined(groupIndex)) {\n          appWrapper.setAttribute('data-group-index', groupIndex.toString());\n        }\n\n        this.parent.eventBase.applyResourceColor(appWrapper, listData[li], 'borderColor', groupOrder);\n        var templateEle = void 0;\n\n        if (!isNullOrUndefined(this.parent.activeViewOptions.eventTemplate)) {\n          templateEle = this.parent.getAppointmentTemplate()(listData[li]);\n        } else {\n          templateEle = this.createAppointment(listData[li]);\n        }\n\n        append([].slice.call(templateEle), appWrapper);\n        listElement.children[li].innerHTML = appWrapper.outerHTML;\n        var args = {\n          data: listData[li],\n          element: listElement.children[li],\n          cancel: false\n        };\n        this.parent.trigger(event.eventRendered, args);\n\n        if (args.cancel) {\n          remove(listElement.children[li]);\n        }\n      }\n    }\n\n    aTd.appendChild(listElement);\n\n    if (this.parent.currentView === 'MonthAgenda' && this.parent.activeViewOptions.group.resources.length > 0 || this.parent.currentView === 'Agenda') {\n      addClass([aTd], cls.AGENDA_DAY_BORDER_CLASS);\n    }\n\n    return aTd;\n  };\n\n  AgendaBase.prototype.createAppointment = function (event) {\n    var fieldMapping = this.parent.eventFields;\n    var eventSubject = event[fieldMapping.subject] || this.parent.eventSettings.fields.subject.default;\n    var eventLocation = event[fieldMapping.location] || this.parent.eventSettings.fields.location.default;\n    var appSubjectWrap = createElement('div', {\n      className: cls.SUBJECT_WRAP\n    });\n\n    if (!isNullOrUndefined(eventLocation) && eventLocation !== '') {\n      eventSubject += ',';\n    }\n\n    appSubjectWrap.appendChild(createElement('div', {\n      className: cls.SUBJECT_CLASS,\n      innerHTML: eventSubject\n    }));\n\n    if (!isNullOrUndefined(eventLocation) && eventLocation !== '') {\n      appSubjectWrap.appendChild(createElement('div', {\n        className: cls.LOCATION_CLASS,\n        innerHTML: eventLocation\n      }));\n    }\n\n    if (!isNullOrUndefined(event[fieldMapping.recurrenceRule])) {\n      var iconClass = event[fieldMapping.id] === event[fieldMapping.recurrenceID] ? cls.EVENT_RECURRENCE_ICON_CLASS : cls.EVENT_RECURRENCE_EDIT_ICON_CLASS;\n      appSubjectWrap.appendChild(createElement('div', {\n        className: cls.ICON + ' ' + iconClass\n      }));\n    }\n\n    var strDate = event[fieldMapping.startTime];\n    var endDate = event[fieldMapping.endTime];\n    var isAllDay = event[fieldMapping.isAllDay];\n    var allDayStr = this.parent.localeObj.getConstant('allDay');\n    var timeStr = this.parent.getTimeString(strDate) + ' - ' + this.parent.getTimeString(endDate);\n\n    if (!isNullOrUndefined(event.data)) {\n      var eventString = (endDate.getTime() - strDate.getTime()) / util.MS_PER_DAY >= 1 ? allDayStr : timeStr;\n      allDayStr = eventString + ' (' + this.parent.localeObj.getConstant('day') + ' ' + event.data.index + '/' + event.data.count + ')';\n    }\n\n    var displayStr = !isNullOrUndefined(event.data) || isAllDay ? allDayStr : timeStr;\n    var appDateTime = createElement('div', {\n      className: cls.DATE_TIME_CLASS,\n      innerHTML: displayStr\n    });\n    return [appSubjectWrap, appDateTime];\n  };\n\n  AgendaBase.prototype.processAgendaEvents = function (events) {\n    var eventsProcessed = [];\n\n    for (var _i = 0, events_1 = events; _i < events_1.length; _i++) {\n      var event_1 = events_1[_i];\n      var splited = this.parent.eventBase.splitEventByDay(event_1);\n      eventsProcessed = eventsProcessed.concat(splited.length > 1 ? splited : event_1);\n    }\n\n    return eventsProcessed;\n  };\n\n  AgendaBase.prototype.wireEventActions = function () {\n    var eventElement = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_CLASS));\n\n    for (var _i = 0, eventElement_1 = eventElement; _i < eventElement_1.length; _i++) {\n      var element = eventElement_1[_i];\n      this.parent.eventBase.wireAppointmentEvents(element);\n    }\n\n    var dateHeaderElement = [].slice.call(this.parent.element.querySelectorAll('.e-m-date'));\n\n    for (var _a = 0, dateHeaderElement_1 = dateHeaderElement; _a < dateHeaderElement_1.length; _a++) {\n      var element = dateHeaderElement_1[_a];\n      EventHandler.add(element, 'click', this.parent.agendaModule.dayNavigationClick, this);\n    }\n  };\n\n  AgendaBase.prototype.calculateResourceTableElement = function (tBody, noOfDays, agendaDate) {\n    if (isNullOrUndefined(this.parent.resourceBase.lastResourceLevel)) {\n      var level = this.viewBase.getDateSlots(this.viewBase.renderDates, this.parent.activeViewOptions.workDays);\n      this.parent.resourceBase.generateResourceLevels(level);\n    }\n\n    var agendaLastDate = util.addDays(new Date(agendaDate.getTime()), noOfDays);\n    var days = this.parent.activeViewOptions.group.byDate || this.parent.currentView === 'MonthAgenda' ? noOfDays : 1;\n    var resColl = this.parent.resourceBase.resourceCollection;\n    var resData = this.parent.resourceBase.lastResourceLevel;\n    var initialDate = agendaDate;\n\n    for (var i = 0; i < days; i++) {\n      var lastLevelInfo = [];\n      var tempLastLevelInfo = [];\n      var tempIndex = 0;\n      var eventObj = void 0;\n      var dateObj = void 0;\n      var firstDate = util.addDays(initialDate, i);\n      var finalDate = this.parent.activeViewOptions.group.byDate || this.parent.currentView === 'MonthAgenda' ? util.addDays(firstDate, 1) : agendaLastDate;\n      var agendaCollection = this.parent.eventBase.filterEvents(firstDate, finalDate);\n\n      if (agendaCollection.length > 0 || !this.parent.hideEmptyAgendaDays || this.parent.currentView === 'MonthAgenda') {\n        for (var res = 0; res < resData.length; res++) {\n          noOfDays = !this.parent.activeViewOptions.group.byDate || this.parent.currentView === 'MonthAgenda' ? noOfDays : 1;\n          var data = [];\n          agendaDate = firstDate;\n          var resDataCollection = this.parent.eventBase.filterEvents(agendaDate, agendaLastDate, agendaCollection, resData[res]);\n\n          if (resDataCollection.length > 0 || !this.parent.hideEmptyAgendaDays || this.parent.currentView === 'MonthAgenda') {\n            for (var r = 0; r < noOfDays; r++) {\n              var resDayCollection = this.parent.eventBase.filterEvents(agendaDate, util.addDays(agendaDate, 1), resDataCollection, undefined);\n\n              if (resDayCollection.length > 0 || !this.parent.hideEmptyAgendaDays || this.parent.currentView === 'MonthAgenda') {\n                data.push(resDayCollection[0]);\n                eventObj = {\n                  rowSpan: 1,\n                  type: 'eventColumn',\n                  resource: resColl[resColl.length - 1],\n                  groupIndex: resData[res].groupIndex,\n                  groupOrder: resData[res].groupOrder,\n                  resourceData: resData[res].resourceData,\n                  eventData: resDayCollection,\n                  date: agendaDate\n                };\n                dateObj = {\n                  rowSpan: 1,\n                  type: 'dateColumn',\n                  resource: resColl[resColl.length - 1],\n                  groupOrder: resData[res].groupOrder,\n                  resourceData: resData[res].resourceData,\n                  date: agendaDate,\n                  text: ''\n                };\n\n                if (!lastLevelInfo[tempIndex]) {\n                  lastLevelInfo[tempIndex] = [];\n                }\n\n                lastLevelInfo[tempIndex].push(eventObj);\n                lastLevelInfo[tempIndex].push(dateObj);\n                tempIndex++;\n              }\n\n              agendaDate = util.addDays(agendaDate, 1);\n\n              if (agendaDate.getTime() >= agendaLastDate.getTime() || this.parent.activeViewOptions.group.byDate || this.parent.currentView === 'MonthAgenda') {\n                lastLevelInfo[lastLevelInfo.length - 1][1].text = 'lastRow';\n                var tempObj = {\n                  rowSpan: data.length,\n                  type: 'resourceColumn',\n                  resource: resColl[resColl.length - 1],\n                  groupOrder: resData[res].groupOrder.slice(0, -1),\n                  resourceData: resData[res].resourceData,\n                  groupIndex: lastLevelInfo.length - data.length,\n                  className: [cls.RESOURCE_NAME],\n                  date: agendaDate\n                };\n                lastLevelInfo[lastLevelInfo.length - data.length].push(tempObj);\n                tempLastLevelInfo.push(extend({}, tempObj, null, true));\n                break;\n              }\n            }\n          }\n        }\n\n        var topResources = resColl.slice(0, -1);\n        var tempGroupedData = [];\n        var totalRowSpan = 0;\n\n        for (var y = 0; y < topResources.length; y++) {\n          var data = topResources[topResources.length - (y + 1)].dataSource;\n\n          for (var x = 0; x < data.length; x++) {\n            var z = 0;\n\n            for (var u = 0; u < tempLastLevelInfo.length; u++) {\n              if (tempLastLevelInfo[u].groupOrder[topResources.length - (y + 1)] === data[x][topResources[topResources.length - (y + 1)].idField]) {\n                totalRowSpan = totalRowSpan + tempLastLevelInfo[u].rowSpan;\n                tempGroupedData.push(extend({}, tempLastLevelInfo[u], null, true));\n              }\n\n              if (++z === tempLastLevelInfo.length && tempGroupedData.length > 0) {\n                tempGroupedData[0].rowSpan = totalRowSpan;\n                tempGroupedData[0].type = 'parentColumnLevel_' + (y + 1);\n                tempGroupedData[0].resource = topResources[topResources.length - (y + 1)];\n                tempGroupedData[0].resourceData = data[x];\n                tempGroupedData[0].date = agendaDate;\n                lastLevelInfo[tempGroupedData[0].groupIndex].push(tempGroupedData[0]);\n                tempGroupedData = [];\n                totalRowSpan = 0;\n              }\n            }\n          }\n        }\n\n        this.createResourceTableRow(lastLevelInfo, tBody);\n      }\n    }\n\n    var totalCollection = this.parent.eventBase.filterEvents(initialDate, agendaLastDate);\n\n    if (totalCollection.length === 0 && !this.parent.activeViewOptions.allowVirtualScrolling && this.parent.hideEmptyAgendaDays) {\n      this.renderEmptyContent(tBody, initialDate);\n    }\n  };\n\n  AgendaBase.prototype.createResourceTableRow = function (tContent, tBody) {\n    var tr = createElement('tr', {\n      attrs: {\n        role: 'row'\n      }\n    });\n    var ntr;\n    var td = createElement('td', {\n      attrs: {\n        role: 'gridcell',\n        'aria-selected': 'false'\n      }\n    });\n    var tempData;\n    var rowSpan = 0;\n    var level;\n\n    if (this.parent.activeViewOptions.group.byDate || this.parent.currentView === 'MonthAgenda') {\n      var tContentCollection = [];\n      var parentCollection = this.parent.resourceBase.resourceCollection.slice(0, -1);\n\n      for (var w = 0; w < tContent.length; w++) {\n        tContentCollection = tContentCollection.concat(tContent[w]);\n      }\n\n      level = parentCollection.length > 0 ? 'parentColumnLevel_' + parentCollection.length : 'resourceColumn';\n      var rowSpanCollection = new DataManager({\n        json: tContentCollection\n      }).executeLocal(new Query().where('type', 'equal', level));\n\n      for (var x = 0; x < rowSpanCollection.length; x++) {\n        rowSpan = rowSpan + rowSpanCollection[x].rowSpan;\n      }\n    }\n\n    for (var row = 0; row < tContent.length; row++) {\n      ntr = tr.cloneNode();\n\n      for (var col = tContent[row].length - 1; col >= 0; col--) {\n        var data = tContent[row][col];\n        var ntd = td.cloneNode();\n\n        if (data.type === 'dateColumn') {\n          if (this.parent.activeViewOptions.group.byDate || this.parent.currentView === 'MonthAgenda') {\n            tempData = tContent[row][col];\n            continue;\n          }\n\n          ntd.setAttribute('data-date', data.date.getTime().toString());\n          ntd.appendChild(this.createDateHeaderElement(data.date));\n          var className = [cls.AGENDA_CELLS_CLASS, cls.AGENDA_DATE_CLASS];\n\n          if (data.text === 'lastRow') {\n            className.push(cls.AGENDA_DAY_BORDER_CLASS);\n          }\n\n          addClass([ntd], className);\n          ntr.appendChild(ntd);\n        } else if (data.type === 'eventColumn') {\n          var elementType = data.eventData.length === 0 ? 'noEvents' : 'data';\n          ntd = this.createAgendaContentElement(elementType, data.eventData, ntd, data.groupOrder, data.groupIndex);\n          ntd.setAttribute('data-date', data.date.getTime().toString());\n\n          if (this.parent.activeViewOptions.group.byDate || this.parent.currentView === 'MonthAgenda') {\n            addClass([ntd], [cls.AGENDA_CELLS_CLASS, cls.AGENDA_DAY_PADDING_CLASS]);\n          }\n\n          ntr.appendChild(ntd);\n        } else {\n          ntd.setAttribute('rowspan', data.rowSpan.toString());\n          addClass([ntd], cls.AGENDA_RESOURCE_CLASS);\n          this.viewBase.setResourceHeaderContent(ntd, data, data.className[0]);\n          ntr.appendChild(ntd);\n        }\n      }\n\n      if (this.parent.activeViewOptions.group.byDate && row === 0 && this.parent.currentView !== 'MonthAgenda') {\n        var ntd = td.cloneNode();\n        ntd.setAttribute('data-date', tempData.date.getTime().toString());\n        ntd.setAttribute('rowspan', rowSpan.toString());\n        ntd.appendChild(this.createDateHeaderElement(tempData.date));\n        addClass([ntd], [cls.AGENDA_CELLS_CLASS, cls.AGENDA_DATE_CLASS, cls.DATE_BORDER_CLASS]);\n        var daysCount = util.getDaysCount(this.parent.selectedDate.getTime(), tempData.date.getTime());\n        ntr.setAttribute('aria-rowindex', daysCount.toString());\n\n        if (this.parent.element.querySelector(\".e-agenda-view tr[aria-rowindex=\\\"\" + daysCount + \"\\\"]\")) {\n          break;\n        }\n\n        ntr.insertBefore(ntd, ntr.childNodes[0]);\n      }\n\n      tBody.appendChild(ntr);\n    }\n  };\n\n  AgendaBase.prototype.createDateHeaderElement = function (date) {\n    var dateHeader;\n\n    if (this.parent.activeViewOptions.dateHeaderTemplate) {\n      dateHeader = createElement('div', {\n        className: cls.AGENDA_HEADER_CLASS\n      });\n      var templateArgs = {\n        date: date,\n        type: 'dateHeader'\n      };\n      var template = this.parent.getDateHeaderTemplate()(templateArgs);\n      append([].slice.call(template), dateHeader);\n    } else {\n      dateHeader = this.viewBase.getMobileDateElement(date, cls.AGENDA_HEADER_CLASS);\n    }\n\n    return dateHeader;\n  };\n\n  AgendaBase.prototype.renderEmptyContent = function (tBody, agendaDate) {\n    var eTr = this.createTableRowElement(agendaDate, 'noEvents');\n    var eTd = eTr.children[0];\n    var noEvents = createElement('div', {\n      className: cls.AGENDA_EMPTY_EVENT_CLASS,\n      innerHTML: this.parent.localeObj.getConstant('noEvents')\n    });\n    eTd.appendChild(noEvents);\n    tBody.appendChild(eTr);\n  };\n\n  AgendaBase.prototype.createTableRowElement = function (date, type) {\n    var daysCount = util.getDaysCount(this.parent.selectedDate.getTime(), date.getTime());\n    var tr = createElement('tr', {\n      attrs: {\n        'role': 'row',\n        'aria-rowindex': daysCount.toString()\n      }\n    });\n    var td = createElement('td', {\n      attrs: {\n        'class': type === 'monthHeader' ? cls.AGENDA_MONTH_HEADER_CLASS : cls.AGENDA_CELLS_CLASS,\n        'role': 'gridcell',\n        'aria-selected': 'false',\n        'aria-colindex': daysCount.toString(),\n        'data-date': date.getTime().toString()\n      }\n    });\n    var dTd = td.cloneNode();\n    var aTd = td.cloneNode();\n    tr.appendChild(dTd);\n\n    if (type !== 'noEvents') {\n      tr.appendChild(aTd);\n    }\n\n    return tr;\n  };\n\n  return AgendaBase;\n}();\n\nexport { AgendaBase };","map":null,"metadata":{},"sourceType":"module"}