{"ast":null,"code":"import { isNullOrUndefined, closest, extend, EventHandler, uniqueID } from '@syncfusion/ej2-base';\nimport { createElement, prepend, append, addClass, removeClass } from '@syncfusion/ej2-base';\nimport { DataManager, Query, Predicate } from '@syncfusion/ej2-data';\nimport { Timezone } from '../timezone/timezone';\nimport { generate } from '../../recurrence-editor/date-generator';\nimport * as util from '../base/util';\nimport * as cls from '../base/css-constant';\nimport * as event from '../base/constant';\n/**\n * EventBase for appointment rendering\n */\n\nvar EventBase =\n/** @class */\nfunction () {\n  /**\n   * Constructor for EventBase\n   */\n  function EventBase(parent) {\n    this.slots = [];\n    this.parent = parent;\n    this.timezone = new Timezone();\n  }\n\n  EventBase.prototype.processData = function (events, timeZonePropChanged, oldTimezone) {\n    var start = this.parent.activeView.startDate();\n    var end = this.parent.activeView.endDate();\n    var fields = this.parent.eventFields;\n    this.parent.eventsProcessed = [];\n    var processed = [];\n    var temp = 1;\n    var generateID = false;\n\n    if (events.length > 0 && isNullOrUndefined(events[0][fields.id])) {\n      generateID = true;\n    }\n\n    for (var _i = 0, events_1 = events; _i < events_1.length; _i++) {\n      var event_1 = events_1[_i];\n\n      if (generateID) {\n        event_1[fields.id] = temp++;\n      }\n\n      if (typeof event_1[fields.startTime] === 'string') {\n        event_1[fields.startTime] = util.getDateFromString(event_1[fields.startTime]);\n      }\n\n      if (typeof event_1[fields.endTime] === 'string') {\n        event_1[fields.endTime] = util.getDateFromString(event_1[fields.endTime]);\n      }\n\n      if (timeZonePropChanged) {\n        this.processTimezoneChange(event_1, oldTimezone);\n      } else {\n        this.processTimezone(event_1);\n      }\n\n      if (!isNullOrUndefined(event_1[fields.recurrenceRule]) && isNullOrUndefined(event_1[fields.recurrenceID])) {\n        processed = processed.concat(this.generateOccurrence(event_1));\n      } else {\n        event_1.Guid = this.generateGuid();\n        processed.push(event_1);\n      }\n    }\n\n    this.parent.eventsProcessed = this.filterEvents(start, end, processed);\n    return processed;\n  };\n\n  EventBase.prototype.timezonePropertyChange = function (oldTimezone) {\n    var processed = this.processData(this.parent.eventsData, true, oldTimezone);\n    this.parent.notify(event.dataReady, {\n      processedData: processed\n    });\n  };\n  /** @private */\n\n\n  EventBase.prototype.timezoneConvert = function (eventData) {\n    var fields = this.parent.eventFields;\n    eventData[fields.startTimezone] = eventData[fields.startTimezone] || eventData[fields.endTimezone];\n    eventData[fields.endTimezone] = eventData[fields.endTimezone] || eventData[fields.startTimezone];\n\n    if (this.parent.timezone) {\n      var startTz = eventData[fields.startTimezone];\n      var endTz = eventData[fields.endTimezone];\n      eventData[fields.startTime] = this.timezone.convert(eventData[fields.startTime], this.parent.timezone, startTz);\n      eventData[fields.endTime] = this.timezone.convert(eventData[fields.endTime], this.parent.timezone, endTz);\n    }\n  };\n\n  EventBase.prototype.processTimezoneChange = function (event, oldTimezone) {\n    var fields = this.parent.eventFields;\n\n    if (oldTimezone && this.parent.timezone) {\n      event[fields.startTime] = this.timezone.convert(event[fields.startTime], oldTimezone, this.parent.timezone);\n      event[fields.endTime] = this.timezone.convert(event[fields.endTime], oldTimezone, this.parent.timezone);\n    } else if (!oldTimezone && this.parent.timezone) {\n      event[fields.startTime] = this.timezone.add(event[fields.startTime], this.parent.timezone);\n      event[fields.endTime] = this.timezone.add(event[fields.endTime], this.parent.timezone);\n    } else if (oldTimezone && !this.parent.timezone) {\n      event[fields.startTime] = this.timezone.remove(event[fields.startTime], oldTimezone);\n      event[fields.endTime] = this.timezone.remove(event[fields.endTime], oldTimezone);\n    }\n  };\n\n  EventBase.prototype.processTimezone = function (event) {\n    var fields = this.parent.eventFields;\n\n    if (event[fields.startTimezone] || event[fields.endTimezone]) {\n      var startTimezone = event[fields.startTimezone] || event[fields.endTimezone];\n      var endTimezone = event[fields.endTimezone] || event[fields.startTimezone];\n      event[fields.startTime] = this.timezone.add(event[fields.startTime], startTimezone);\n      event[fields.endTime] = this.timezone.add(event[fields.endTime], endTimezone);\n\n      if (this.parent.timezone) {\n        var zone = this.parent.timezone;\n        event[fields.startTime] = this.timezone.convert(event[fields.startTime], startTimezone, zone);\n        event[fields.endTime] = this.timezone.convert(event[fields.endTime], endTimezone, zone);\n      }\n    } else if (this.parent.timezone) {\n      event[fields.startTime] = this.timezone.add(event[fields.startTime], this.parent.timezone);\n      event[fields.endTime] = this.timezone.add(event[fields.endTime], this.parent.timezone);\n    }\n  };\n\n  EventBase.prototype.filterEvents = function (startDate, endDate, appointments, resourceTdData) {\n    if (appointments === void 0) {\n      appointments = this.parent.eventsProcessed;\n    }\n\n    var fieldMapping = this.parent.eventFields;\n    var predicate = new Predicate(fieldMapping.startTime, 'greaterthanorequal', startDate).and(new Predicate(fieldMapping.endTime, 'greaterthanorequal', startDate)).and(new Predicate(fieldMapping.startTime, 'lessthan', endDate)).or(new Predicate(fieldMapping.startTime, 'lessthanorequal', startDate).and(new Predicate(fieldMapping.endTime, 'greaterthan', startDate)));\n    var filter = new DataManager({\n      json: appointments\n    }).executeLocal(new Query().where(predicate));\n\n    if (resourceTdData) {\n      filter = this.filterEventsByResource(resourceTdData, filter);\n    }\n\n    return this.sortByTime(filter);\n  };\n\n  EventBase.prototype.filterEventsByResource = function (resourceTdData, appointments) {\n    if (appointments === void 0) {\n      appointments = this.parent.eventsProcessed;\n    }\n\n    var predicate;\n    var resourceCollection = this.parent.resourceBase.resourceCollection;\n\n    for (var level = 0; level < resourceCollection.length; level++) {\n      var operator = this.parent.activeViewOptions.group.allowGroupEdit && resourceCollection[level].allowMultiple ? 'contains' : 'equal';\n      var tempPredicate = new Predicate(resourceCollection[level].field, operator, resourceTdData.groupOrder[level]);\n      predicate = predicate ? predicate.and(tempPredicate) : tempPredicate;\n    }\n\n    return new DataManager({\n      json: appointments\n    }).executeLocal(new Query().where(predicate));\n  };\n\n  EventBase.prototype.sortByTime = function (appointments) {\n    var fieldMapping = this.parent.eventFields;\n    appointments.sort(function (a, b) {\n      var d1 = a[fieldMapping.startTime];\n      var d2 = b[fieldMapping.startTime];\n      return d1.getTime() - d2.getTime();\n    });\n    return appointments;\n  };\n\n  EventBase.prototype.sortByDateTime = function (appointments) {\n    var fieldMapping = this.parent.eventFields;\n    appointments.sort(function (object1, object2) {\n      var d3 = object1[fieldMapping.startTime];\n      var d4 = object2[fieldMapping.startTime];\n      var d5 = object1[fieldMapping.endTime];\n      var d6 = object2[fieldMapping.endTime];\n      var d1 = d5.getTime() - d3.getTime();\n      var d2 = d6.getTime() - d4.getTime();\n      return d3.getTime() - d4.getTime() || d2 - d1;\n    });\n    return appointments;\n  };\n\n  EventBase.prototype.getSmallestMissingNumber = function (array) {\n    var large = Math.max.apply(Math, array);\n\n    for (var i = 0; i < large; i++) {\n      if (array.indexOf(i) === -1) {\n        return i;\n      }\n    }\n\n    return large + 1;\n  };\n\n  EventBase.prototype.splitEventByDay = function (event) {\n    var eventFields = this.parent.eventFields;\n    var data = [];\n    var eventStartTime = event[eventFields.startTime];\n    var eventEndTime = event[eventFields.endTime];\n    var isDifferentDate = util.resetTime(new Date(eventStartTime.getTime())) < util.resetTime(new Date(eventEndTime.getTime()));\n\n    if (isDifferentDate) {\n      var start = new Date(eventStartTime.getTime());\n      var end = util.addDays(util.resetTime(new Date(eventStartTime.getTime())), 1);\n      var endDate = eventEndTime.getHours() === 0 && eventEndTime.getMinutes() === 0 ? eventEndTime : util.addDays(eventEndTime, 1);\n      var index = 1;\n      var eventLength = util.getDaysCount(eventStartTime.getTime(), endDate.getTime());\n\n      while (end <= eventEndTime) {\n        var app = extend({}, event);\n        app[eventFields.startTime] = start;\n        app[eventFields.endTime] = end;\n        app.data = {\n          index: index,\n          count: eventLength\n        };\n        app.Guid = this.generateGuid();\n        app.isSpanned = true;\n        data.push(app);\n        start = end;\n\n        if (new Date(start.getTime()).setHours(0, 0, 0, 0) === new Date(eventEndTime.getTime()).setHours(0, 0, 0, 0) && !(end.getTime() === eventEndTime.getTime())) {\n          end = new Date(new Date(start.getTime()).setHours(eventEndTime.getHours(), eventEndTime.getMinutes()));\n        } else {\n          end = util.addDays(util.resetTime(new Date(start.getTime())), 1);\n        }\n\n        index++;\n      }\n    } else {\n      data.push(event);\n    }\n\n    return data;\n  };\n\n  EventBase.prototype.splitEvent = function (event, dateRender) {\n    var fields = this.parent.eventFields;\n    var start = util.resetTime(new Date(event[fields.startTime] + '')).getTime();\n    var end = util.resetTime(new Date(event[fields.endTime] + '')).getTime();\n\n    if (util.getDateInMs(event[fields.endTime]) <= 0) {\n      var temp = util.addDays(util.resetTime(new Date(event[fields.endTime] + '')), -1).getTime();\n      end = start > temp ? start : temp;\n    }\n\n    var orgStart = start;\n    var orgEnd = end;\n    var ranges = [];\n\n    if (start !== end) {\n      if (start < dateRender[0].getTime()) {\n        start = dateRender[0].getTime();\n      }\n\n      if (end > dateRender[dateRender.length - 1].getTime()) {\n        end = dateRender[dateRender.length - 1].getTime();\n      }\n\n      var cStart = start;\n\n      for (var level = 0; level < this.slots.length; level++) {\n        var slot = this.slots[level];\n        var firstSlot = slot[0];\n        cStart = cStart <= firstSlot && end >= firstSlot ? firstSlot : cStart;\n\n        if (cStart > end || firstSlot > end) {\n          break;\n        }\n\n        if (!this.parent.activeViewOptions.group.byDate && this.parent.activeViewOptions.showWeekend && this.parent.currentView !== 'WorkWeek' && this.parent.currentView !== 'TimelineWorkWeek') {\n          var startIndex = slot.indexOf(cStart);\n\n          if (startIndex !== -1) {\n            var endIndex = slot.indexOf(end);\n            var hasBreak = endIndex !== -1;\n            endIndex = hasBreak ? endIndex : slot.length - 1;\n            var count = endIndex - startIndex + 1;\n            var isLeft = slot[startIndex] !== orgStart;\n            var isRight = slot[endIndex] !== orgEnd;\n            ranges.push(this.cloneEventObject(event, slot[startIndex], slot[endIndex], count, isLeft, isRight));\n\n            if (hasBreak) {\n              break;\n            }\n          }\n        } else {\n          if (this.dateInRange(cStart, slot[0], slot[slot.length - 1])) {\n            var availSlot = [];\n\n            for (var i = 0; i < slot.length; i++) {\n              if (this.dateInRange(slot[i], orgStart, orgEnd)) {\n                availSlot.push(slot[i]);\n              }\n            }\n\n            if (availSlot.length > 0) {\n              if (!this.parent.activeViewOptions.group.byDate) {\n                var isLeft = availSlot[0] !== orgStart;\n                var isRight = availSlot[availSlot.length - 1] !== orgEnd;\n                ranges.push(this.cloneEventObject(event, availSlot[0], availSlot[availSlot.length - 1], availSlot.length, isLeft, isRight));\n              } else {\n                for (var _i = 0, availSlot_1 = availSlot; _i < availSlot_1.length; _i++) {\n                  var slot_1 = availSlot_1[_i];\n                  ranges.push(this.cloneEventObject(event, slot_1, slot_1, 1, slot_1 !== orgStart, slot_1 !== orgEnd));\n                }\n              }\n            }\n          }\n        }\n      }\n    } else {\n      ranges.push(this.cloneEventObject(event, start, end, 1, false, false));\n    }\n\n    return ranges;\n  };\n\n  EventBase.prototype.cloneEventObject = function (event, start, end, count, isLeft, isRight) {\n    var fields = this.parent.eventFields;\n    var e = extend({}, event, null, true);\n    var data = {\n      count: count,\n      isLeft: isLeft,\n      isRight: isRight\n    };\n    data[fields.startTime] = event[fields.startTime];\n    data[fields.endTime] = event[fields.endTime];\n    e.data = data;\n    e[fields.startTime] = new Date(start);\n    e[fields.endTime] = new Date(end);\n    return e;\n  };\n\n  EventBase.prototype.dateInRange = function (date, start, end) {\n    return start <= date && date <= end;\n  };\n\n  EventBase.prototype.getSelectedEventElements = function (target) {\n    this.removeSelectedAppointmentClass();\n\n    if (this.parent.selectedElements.length <= 0) {\n      this.parent.selectedElements.push(target);\n    } else {\n      var isAlreadySelected = this.parent.selectedElements.filter(function (element) {\n        return element.getAttribute('data-guid') === target.getAttribute('data-guid');\n      });\n\n      if (isAlreadySelected.length <= 0) {\n        var focusElements = [].slice.call(this.parent.element.querySelectorAll('div[data-guid=\"' + target.getAttribute('data-guid') + '\"]'));\n\n        for (var _i = 0, focusElements_1 = focusElements; _i < focusElements_1.length; _i++) {\n          var element = focusElements_1[_i];\n          this.parent.selectedElements.push(element);\n        }\n      } else {\n        var selectedElements = this.parent.selectedElements.filter(function (element) {\n          return element.getAttribute('data-guid') !== target.getAttribute('data-guid');\n        });\n        this.parent.selectedElements = selectedElements;\n      }\n    }\n\n    if (target && this.parent.selectedElements.length > 0) {\n      this.addSelectedAppointments(this.parent.selectedElements);\n    }\n\n    return this.parent.selectedElements;\n  };\n\n  EventBase.prototype.getSelectedEvents = function () {\n    var _this = this;\n\n    var eventSelect = [];\n    var elementSelect = [];\n    var selectAppointments = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_BORDER));\n    selectAppointments.filter(function (element) {\n      eventSelect.push(_this.getEventByGuid(element.getAttribute('data-guid')));\n      elementSelect.push(element);\n    });\n    return {\n      event: eventSelect.length > 1 ? eventSelect : eventSelect[0],\n      element: elementSelect.length > 1 ? elementSelect : elementSelect[0]\n    };\n  };\n\n  EventBase.prototype.removeSelectedAppointmentClass = function () {\n    var selectedAppointments = this.getSelectedAppointments();\n\n    for (var _i = 0, selectedAppointments_1 = selectedAppointments; _i < selectedAppointments_1.length; _i++) {\n      var appointment = selectedAppointments_1[_i];\n      appointment.setAttribute('aria-selected', 'false');\n    }\n\n    removeClass(selectedAppointments, cls.APPOINTMENT_BORDER);\n\n    if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n      removeClass(selectedAppointments, cls.AGENDA_SELECTED_CELL);\n    }\n  };\n\n  EventBase.prototype.addSelectedAppointments = function (cells) {\n    for (var _i = 0, cells_1 = cells; _i < cells_1.length; _i++) {\n      var cell = cells_1[_i];\n      cell.setAttribute('aria-selected', 'true');\n    }\n\n    this.parent.removeSelectedClass();\n    addClass(cells, cls.APPOINTMENT_BORDER);\n  };\n\n  EventBase.prototype.getSelectedAppointments = function () {\n    return [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_BORDER + ',.' + cls.APPOINTMENT_CLASS + ':focus'));\n  };\n\n  EventBase.prototype.focusElement = function () {\n    var selectedCell = this.parent.getSelectedElements();\n\n    if (selectedCell.length > 0) {\n      if (this.parent.keyboardInteractionModule) {\n        var target = !isNullOrUndefined(this.parent.activeCellsData) && this.parent.activeCellsData.element || selectedCell[selectedCell.length - 1];\n        this.parent.keyboardInteractionModule.selectCells(false, target);\n      }\n\n      return;\n    }\n\n    var selectedAppointments = this.getSelectedAppointments();\n\n    if (selectedAppointments.length > 0) {\n      selectedAppointments[selectedAppointments.length - 1].focus();\n      return;\n    }\n  };\n\n  EventBase.prototype.selectWorkCellByTime = function (eventsData) {\n    var target;\n\n    if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n      return target;\n    }\n\n    if (eventsData.length > 0) {\n      var selectedObject = eventsData[eventsData.length - 1];\n      var eventStartTime = selectedObject[this.parent.eventFields.startTime];\n      var nearestTime = new Date(+eventStartTime).setMinutes(0, 0, 0);\n      var isAllDay = this.isAllDayAppointment(selectedObject);\n\n      if (this.parent.currentView === 'Month' || isAllDay) {\n        nearestTime = new Date(+eventStartTime).setHours(0, 0, 0, 0);\n      }\n\n      var targetArea = void 0;\n\n      if (isAllDay && ['Day', 'Week', 'WorkWeek'].indexOf(this.parent.currentView) !== -1) {\n        targetArea = this.parent.getAllDayRow();\n      } else {\n        targetArea = this.parent.getContentTable();\n      }\n\n      var queryString = '[data-date=\"' + nearestTime + '\"]';\n\n      if (this.parent.activeViewOptions.group.resources.length > 0) {\n        queryString += '[data-group-index=\"' + this.getGroupIndexFromEvent(selectedObject) + '\"]';\n      }\n\n      target = targetArea.querySelector(queryString);\n\n      if (target) {\n        this.parent.activeCellsData = this.parent.getCellDetails(target);\n\n        if (this.parent.keyboardInteractionModule) {\n          this.parent.keyboardInteractionModule.selectCells(false, target);\n        }\n\n        return target;\n      }\n    }\n\n    return target;\n  };\n\n  EventBase.prototype.getGroupIndexFromEvent = function (eventData) {\n    var groupOrder = [];\n    var groupIndex = 0;\n\n    for (var _i = 0, _a = this.parent.resourceBase.resourceCollection; _i < _a.length; _i++) {\n      var resourceData = _a[_i];\n      groupOrder.push(eventData[resourceData.field]);\n    }\n\n    this.parent.resourceBase.lastResourceLevel.forEach(function (resource) {\n      var count;\n      var order = resource.groupOrder;\n      order.forEach(function (resIndex, index) {\n        var resValue = groupOrder[index] instanceof Array ? groupOrder[index][index] : groupOrder[index];\n\n        if (resValue === resIndex) {\n          count = count ? count + 1 : 1;\n        }\n      });\n\n      if (order.length === count) {\n        groupIndex = resource.groupIndex;\n      }\n    });\n    return groupIndex;\n  };\n\n  EventBase.prototype.isAllDayAppointment = function (event) {\n    var fieldMapping = this.parent.eventFields;\n    var isAllDay = event[fieldMapping.isAllDay];\n    var isFullDay = (event[fieldMapping.endTime].getTime() - event[fieldMapping.startTime].getTime()) / util.MS_PER_DAY >= 1;\n    return isAllDay || isFullDay ? true : false;\n  };\n\n  EventBase.prototype.addEventListener = function () {\n    this.parent.on(event.documentClick, this.appointmentBorderRemove, this);\n  };\n\n  EventBase.prototype.appointmentBorderRemove = function (event) {\n    var element = event.event.target;\n\n    if (closest(element, '.' + cls.APPOINTMENT_CLASS)) {\n      this.parent.removeSelectedClass();\n    } else if (!closest(element, '.' + cls.POPUP_OPEN)) {\n      this.removeSelectedAppointmentClass();\n    }\n  };\n\n  EventBase.prototype.wireAppointmentEvents = function (element, isAllDay) {\n    if (isAllDay === void 0) {\n      isAllDay = false;\n    }\n\n    EventHandler.add(element, 'click', this.eventClick, this);\n    EventHandler.add(element, 'dblclick', this.eventDoubleClick, this);\n\n    if (!this.parent.activeViewOptions.readonly && ['Agenda', 'MonthAgenda'].indexOf(this.parent.currentView) === -1) {\n      if (this.parent.resizeModule) {\n        this.parent.resizeModule.wireResizeEvent(element);\n      }\n\n      if (this.parent.dragAndDropModule && !this.parent.isAdaptive) {\n        this.parent.dragAndDropModule.wireDragEvent(element, isAllDay);\n      }\n    }\n  };\n\n  EventBase.prototype.renderResizeHandler = function (element, spanEvent) {\n    if (!this.parent.resizeModule || !this.parent.allowResizing || this.parent.activeViewOptions.readonly) {\n      return;\n    }\n\n    for (var _i = 0, _a = Object.keys(spanEvent); _i < _a.length; _i++) {\n      var resizeEdge = _a[_i];\n      var resizeHandler = createElement('div', {\n        className: cls.EVENT_RESIZE_CLASS\n      });\n\n      switch (resizeEdge) {\n        case 'isLeft':\n          if (!spanEvent.isLeft) {\n            resizeHandler.appendChild(createElement('div', {\n              className: 'e-left-right-resize'\n            }));\n            addClass([resizeHandler], this.parent.enableRtl ? cls.RIGHT_RESIZE_HANDLER : cls.LEFT_RESIZE_HANDLER);\n            prepend([resizeHandler], element);\n          }\n\n          break;\n\n        case 'isRight':\n          if (!spanEvent.isRight) {\n            resizeHandler.appendChild(createElement('div', {\n              className: 'e-left-right-resize'\n            }));\n            addClass([resizeHandler], this.parent.enableRtl ? cls.LEFT_RESIZE_HANDLER : cls.RIGHT_RESIZE_HANDLER);\n            append([resizeHandler], element);\n          }\n\n          break;\n\n        case 'isTop':\n          if (!spanEvent.isTop) {\n            resizeHandler.appendChild(createElement('div', {\n              className: 'e-top-bottom-resize'\n            }));\n            addClass([resizeHandler], cls.TOP_RESIZE_HANDLER);\n            prepend([resizeHandler], element);\n          }\n\n          break;\n\n        case 'isBottom':\n          if (!spanEvent.isBottom) {\n            resizeHandler.appendChild(createElement('div', {\n              className: 'e-top-bottom-resize'\n            }));\n            addClass([resizeHandler], cls.BOTTOM_RESIZE_HANDLER);\n            append([resizeHandler], element);\n          }\n\n          break;\n      }\n    }\n  };\n\n  EventBase.prototype.eventClick = function (eventData) {\n    var target = eventData.target;\n\n    if (target.classList.contains(cls.DRAG_CLONE_CLASS) || target.classList.contains(cls.RESIZE_CLONE_CLASS)) {\n      return;\n    }\n\n    if (eventData.ctrlKey && eventData.which === 1 && this.parent.keyboardInteractionModule) {\n      this.parent.quickPopup.quickPopup.hide();\n      this.parent.selectedElements = [].slice.call(this.parent.element.querySelectorAll('.' + cls.APPOINTMENT_BORDER));\n      this.parent.keyboardInteractionModule.onAppointmentSelection(eventData);\n      return;\n    }\n\n    this.removeSelectedAppointmentClass();\n    this.activeEventData(eventData);\n    var args = extend(this.parent.activeEventData, {\n      cancel: false\n    });\n    this.parent.trigger(event.eventClick, args);\n\n    if (args.cancel) {\n      this.removeSelectedAppointmentClass();\n      return;\n    }\n\n    if (this.parent.currentView === 'Agenda' || this.parent.currentView === 'MonthAgenda') {\n      addClass([args.element], cls.AGENDA_SELECTED_CELL);\n    }\n\n    this.parent.notify(event.eventClick, this.parent.activeEventData);\n  };\n\n  EventBase.prototype.eventDoubleClick = function (e) {\n    this.parent.quickPopup.quickPopupHide(true);\n\n    if (e.type === 'touchstart') {\n      this.activeEventData(e);\n    }\n\n    this.removeSelectedAppointmentClass();\n    var fieldMapping = this.parent.eventFields;\n\n    if (!isNullOrUndefined(this.parent.activeEventData.event) && isNullOrUndefined(this.parent.activeEventData.event[fieldMapping.recurrenceID])) {\n      this.parent.currentAction = 'Save';\n      this.parent.eventWindow.openEditor(this.parent.activeEventData.event, 'Save');\n    } else {\n      this.parent.currentAction = 'EditOccurrence';\n      this.parent.quickPopup.openRecurrenceAlert();\n    }\n  };\n\n  EventBase.prototype.getEventByGuid = function (guid) {\n    return new DataManager({\n      json: this.parent.eventsProcessed\n    }).executeLocal(new Query().where('Guid', 'equal', guid))[0];\n  };\n\n  EventBase.prototype.generateGuid = function () {\n    return 'xyxxxxyx-xxxy-yxxx-xyxx-xxyxxxxyyxxx'.replace(/[xy]/g, function (c) {\n      var r = Math.random() * 16 | 0;\n      var v = c === 'x' ? r : r & 0x3 | 0x8;\n      return v.toString(16);\n    });\n  };\n\n  EventBase.prototype.getEventIDType = function () {\n    return typeof this.parent.eventsData[0][this.parent.eventFields.id];\n  };\n\n  EventBase.prototype.getEventMaxID = function (resourceId) {\n    var _this = this;\n\n    if (this.parent.eventsData.length < 1) {\n      return 1;\n    }\n\n    var eventId;\n    var idType = this.getEventIDType();\n\n    if (idType === 'string') {\n      eventId = uniqueID().toString();\n    }\n\n    if (idType === 'number') {\n      var maxId = Math.max.apply(Math, this.parent.eventsData.map(function (event) {\n        return event[_this.parent.eventFields.id];\n      }));\n      maxId = isNullOrUndefined(resourceId) ? maxId : maxId + resourceId;\n      eventId = maxId + 1;\n    }\n\n    return eventId;\n  };\n\n  EventBase.prototype.activeEventData = function (eventData) {\n    var _this = this;\n\n    var target = closest(eventData.target, '.' + cls.APPOINTMENT_CLASS);\n    var guid = target.getAttribute('data-guid');\n    this.addSelectedAppointments([].slice.call(this.parent.element.querySelectorAll('div[data-guid=\"' + guid + '\"]')));\n    var eventObject = this.getEventByGuid(guid);\n\n    if (eventObject && eventObject.isSpanned) {\n      eventObject = this.parent.eventsData.filter(function (obj) {\n        return obj[_this.parent.eventFields.id] === eventObject[_this.parent.eventFields.id];\n      })[0];\n    }\n\n    this.parent.activeEventData = {\n      event: eventObject,\n      element: target\n    };\n  };\n\n  EventBase.prototype.generateOccurrence = function (event, viewDate) {\n    var fields = this.parent.eventFields;\n    var startDate = event[fields.startTime];\n    var endDate = event[fields.endTime];\n    var occurrenceCollection = [];\n    var currentViewDate = isNullOrUndefined(viewDate) ? this.parent.activeView.startDate() : viewDate;\n    var eventRule = event[fields.recurrenceRule];\n    var duration = endDate.getTime() - startDate.getTime();\n    currentViewDate = new Date(+currentViewDate - duration);\n    var dates = generate(startDate, eventRule, event[fields.recurrenceException], this.parent.firstDayOfWeek, undefined, currentViewDate);\n\n    if (this.parent.currentView === 'Agenda' && eventRule.indexOf('COUNT') === -1 && eventRule.indexOf('UNTIL') === -1) {\n      if (isNullOrUndefined(event.generatedDates)) {\n        event.generatedDates = {\n          start: new Date(dates[0]),\n          end: new Date(dates[dates.length - 1])\n        };\n      } else {\n        if (dates[0] < event.generatedDates.start.getTime()) {\n          event.generatedDates.start = new Date(dates[0]);\n        }\n\n        if (dates[dates.length - 1] > event.generatedDates.end.getTime()) {\n          event.generatedDates.end = new Date(dates[dates.length - 1]);\n        }\n      }\n    }\n\n    var date = dates.shift();\n\n    while (date) {\n      var clonedObject = extend({}, event, null, true);\n      clonedObject[fields.startTime] = new Date(date);\n      clonedObject[fields.endTime] = new Date(new Date(date).setMilliseconds(duration));\n      clonedObject[fields.recurrenceID] = clonedObject[fields.id];\n      clonedObject.Guid = this.generateGuid();\n      occurrenceCollection.push(clonedObject);\n      date = dates.shift();\n    }\n\n    return occurrenceCollection;\n  };\n\n  EventBase.prototype.getRecurrenceEvent = function (eventData) {\n    var eventFields = this.parent.eventFields;\n    var parentApp = new DataManager(this.parent.eventsData).executeLocal(new Query().where(eventFields.id, 'equal', eventData[eventFields.recurrenceID]));\n    return parentApp[0];\n  };\n\n  EventBase.prototype.getOccurrencesByID = function (id) {\n    var fields = this.parent.eventFields;\n    var occurrenceCollection = [];\n    var parentObject = this.parent.eventsData.filter(function (obj) {\n      return obj[fields.id] === id;\n    });\n\n    for (var _i = 0, _a = parentObject; _i < _a.length; _i++) {\n      var event_2 = _a[_i];\n\n      if (!isNullOrUndefined(event_2[fields.recurrenceRule])) {\n        occurrenceCollection = occurrenceCollection.concat(this.generateOccurrence(event_2));\n      }\n    }\n\n    return occurrenceCollection;\n  };\n\n  EventBase.prototype.getOccurrencesByRange = function (startTime, endTime) {\n    var fields = this.parent.eventFields;\n    var occurrenceCollection = [];\n\n    for (var _i = 0, _a = this.parent.eventsData; _i < _a.length; _i++) {\n      var event_3 = _a[_i];\n\n      if (!isNullOrUndefined(event_3[fields.recurrenceRule])) {\n        occurrenceCollection = occurrenceCollection.concat(this.generateOccurrence(event_3));\n      }\n    }\n\n    var filter = occurrenceCollection.filter(function (obj) {\n      return obj[fields.startTime] >= startTime && obj[fields.endTime] <= endTime && !isNullOrUndefined(obj[fields.recurrenceID]);\n    });\n    return filter;\n  };\n\n  EventBase.prototype.applyResourceColor = function (element, eventData, type, groupOrder, alpha) {\n    if (!this.parent.resourceBase) {\n      return;\n    }\n\n    var alphaColor = function alphaColor(color, alpha) {\n      color = color.replace('#', '');\n      var r = parseInt(color.substring(0, color.length / 3), 16);\n      var g = parseInt(color.substring(color.length / 3, 2 * color.length / 3), 16);\n      var b = parseInt(color.substring(2 * color.length / 3, 3 * color.length / 3), 16);\n      return \"rgba(\" + r + \", \" + g + \", \" + b + \", \" + alpha + \")\";\n    };\n\n    var color = this.parent.resourceBase.getResourceColor(eventData, groupOrder);\n\n    if (color) {\n      // tslint:disable-next-line:no-any\n      element.style[type] = !isNullOrUndefined(alpha) ? alphaColor(color, alpha) : color;\n    }\n  };\n\n  return EventBase;\n}();\n\nexport { EventBase };","map":null,"metadata":{},"sourceType":"module"}